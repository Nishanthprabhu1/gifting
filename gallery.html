<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Poppins', sans-serif; }
        .back-nav { position: absolute; top: 15px; left: 15px; z-index: 200; color: white; text-decoration: none; background: rgba(0,0,0,0.6); padding: 8px 15px; border-radius: 20px; font-size: 13px; }
        
        #instruction { 
            position: absolute; bottom: 40px; width: 100%; text-align: center; 
            color: white; z-index: 100; display: none; text-shadow: 0 2px 10px #5E0F8B;
            pointer-events: none;
        }

        /* The Flash Effect Overlay */
        #flash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; opacity: 0; z-index: 1000; pointer-events: none;
        }
    </style>
</head>
<body>

    <a href="index.html" class="back-nav">üè† Menu</a>
    <div id="flash"></div>
    <div id="instruction">üì∏ Tap to snap to the next memory!</div>

    <a-scene mindar-image="imageTargetSrc: ./targets.mind; targetIndex: 1;" 
             vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false"
             cursor="fuse: false; rayOrigin: mouse;" raycaster="objects: .clickable">
        
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 1" id="gift-target">
            <a-image id="display-img" 
                     src="assets/pic1.jpg" 
                     width="1" height="1" 
                     position="0 0 0" 
                     class="clickable"
                     animation__scale="property: scale; from: 1 1 1; to: 1.05 1.05 1.05; dur: 100; startEvents: click">
            </a-image>
        </a-entity>
    </a-scene>

    <script>
        const pics = [
            "assets/pic1.jpg", 
            "assets/pic2.jpg", 
            "assets/pic3.jpg",
            "assets/pic4.jpg",
            "assets/pic5.jpg"
        ];
        
        let currentIdx = 0;
        const imgEl = document.querySelector('#display-img');
        const targetEl = document.querySelector('#gift-target');
        const instruction = document.querySelector('#instruction');
        const flashEl = document.querySelector('#flash');

        targetEl.addEventListener('targetFound', () => {
            instruction.style.display = 'block';
        });

        targetEl.addEventListener('targetLost', () => {
            instruction.style.display = 'none';
        });

        // The "Snap" Logic
        imgEl.addEventListener('click', function() {
            // 1. Trigger Flash
            flashEl.style.opacity = '1';
            setTimeout(() => { flashEl.style.opacity = '0'; }, 1500); // Quick flash

            // 2. Change Image
            currentIdx = (currentIdx + 1) % pics.length;
            this.setAttribute('src', pics[currentIdx]);

            // 3. Haptic Feedback (vibrate phone if supported)
            if (window.navigator.vibrate) {
                window.navigator.vibrate(50);
            }
        });
    </script>
</body>
</html>
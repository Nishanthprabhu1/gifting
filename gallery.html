<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Poppins', sans-serif; }
        .back-nav { position: absolute; top: 15px; left: 15px; z-index: 200; color: white; text-decoration: none; background: rgba(0,0,0,0.6); padding: 8px 15px; border-radius: 20px; font-size: 13px; }
        #instruction { 
            position: absolute; bottom: 40px; width: 100%; text-align: center; 
            color: white; z-index: 100; display: none; text-shadow: 0 2px 10px #5E0F8B;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <a href="index.html" class="back-nav">üè† Menu</a>
    <div id="instruction">üéÅ Rub your finger to reveal the surprise!</div>

    <a-scene mindar-image="imageTargetSrc: ./targets.mind; targetIndex: 1;" 
             vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false"
             cursor="fuse: false; rayOrigin: mouse;" raycaster="objects: .scratchable">
        
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 1" id="gift-target">
            
            <a-image id="receiver-photo" src="assets/pic1.jpg" width="1" height="1" position="0 0 -0.01"></a-image>

            <a-image id="gift-cover" src="assets/gift_wrap.jpg" width="1" height="1" position="0 0 0" class="scratchable"></a-image>

        </a-entity>
    </a-scene>

    <script>
        const cover = document.querySelector('#gift-cover');
        const target = document.querySelector('#gift-target');
        const instruction = document.querySelector('#instruction');
        
        let opacity = 1.0;

        target.addEventListener('targetFound', () => {
            instruction.style.display = 'block';
        });

        target.addEventListener('targetLost', () => {
            instruction.style.display = 'none';
        });

        // This logic detects "scratching" by listening for mousemove/touchmove
        // while the user is clicking on the gift cover
        cover.addEventListener('mouseenter', () => {
            // As the user 'rubs' the image, it slowly fades away
            if (opacity > 0) {
                opacity -= 0.05; // Adjust this number to make it scratch faster/slower
                cover.setAttribute('material', 'opacity', opacity);
            }
            
            if (opacity <= 0.1) {
                cover.setAttribute('visible', 'false');
                instruction.innerText = "‚ú® Surprise Revealed! ‚ú®";
            }
        });

        // For mobile touch support
        cover.addEventListener('mousedown', () => {
            const interval = setInterval(() => {
                if (opacity > 0) {
                    opacity -= 0.1;
                    cover.setAttribute('material', 'opacity', opacity);
                } else {
                    clearInterval(interval);
                }
            }, 50);
        });
    </script>
</body>
</html>